---
layout: post
title: Interesting Features of Virtual Dom
---

In learning about Clojure I learned about ClojureScript and then Om which creates the html in ClojureScript. At first I was put off by not having HTML(or HTML representation) separate from the javascript(or ClojureSript). I had been taught there should be a separation so developers and UX could work independently.

On the other hand, they have to link at some point if you want non-static web pages. JQuery uses selectors to add listeners and functionality. Angular deals with this by using ng-directives. You still have the mixture somewhere.

I did see some power in having the two mixed together. If the mixture is in Javascript then the functionality and the view can be modified together. Also since the templates are generated by functions, we can use things like higher-order functions, recursion, partial application, composition, and memoization. These features have lead to virtual dom being used in functional and functional reactive libraries like [mercury](https://github.com/Raynos/mercury/) and [elm-html](http://elm-lang.org/blog/Blazing-Fast-Html.elm).

This post is an exploration of what you can do with representations of HTML mixed with javascript. I wouldn't be surprised if many of these examples can be recreated in Jade or Mustache templates.

I will be using [virtual-dom](https://github.com/Matt-Esch/virtual-dom) but this should be applicable to React's or Mithril's virtual doms.

### Higer-Order Functions

```javascript
var h = require('virtual-dom/h');
var createElement = require('virtual-dom/create-element');

function itemSqr(x){
  return h('li', (x*x).toString());
}

function itemDouble(x){
  return h('li', (x*2).toString());
}

function renderList(arr, fn)  {
  return h('ul',
    arr.map(fn)
  );
}

var list = [1, 2, 3, 4, 5];

var tree = h('div',
               [renderList(list, itemDouble),
                renderList(list, itemSqr)]
            );
var rootNode = createElement(tree);
document.body.appendChild(rootNode);

```

A simple example of how list can be generated by different functions different ways.

### Recursion

```javascript
var h = require('virtual-dom/h');
var createElement = require('virtual-dom/create-element');

function recListRender(data){
  return h('ul',
    data.map(function(x){
      return Array.isArray(x) ? recListRender(x) : h('li', x);
    })
  )
}

var list = ["a", "b", ["b.1", "b.2"], "c", ["c.1", ["c.1.1", "c.1.2"]]];

var tree = recListRender(list);
var rootNode = createElement(tree);
document.body.appendChild(rootNode);
```
Simple example again. If the element in the list is an array recurse else give a li element.

### Partial Application

```javascript
var h = require('virtual-dom/h');
var createElement = require('virtual-dom/create-element');
var _ = require('underscore');

function liWithFn(fn, x){
  return h('li', fn(x));
}

var itemSqr = _.partial(liWithFn, function(x){
  return (x*x).toString();
});

var itemDouble = _.partial(liWithFn, function(x){
  return (x*2).toString();
});

function renderList(arr, fn)  {
    return h('ul',
      arr.map(fn)
    );
}

var list = [1, 2, 3, 4, 5];

var tree = h('div',
               [renderList(list, itemDouble),
                renderList(list, itemSqr)]
            );
var rootNode = createElement(tree);
document.body.appendChild(rootNode);
```
I included underscore.js for it's partial function and repurposed the code we used earlier for higher-order functions.

### Composition

```javascript
var h = require('virtual-dom/h');
var createElement = require('virtual-dom/create-element');
var _ = require('underscore');

function renderLItems (xs){
  return xs.map(function(x){
    return h('li', x)
  })
}

function renderList (xs){
  return h('ul', xs);
}

var renderCompleteList = _.compose(renderList, renderLItems);

var list = ["a", "b", "c", "d", "e"];

var tree = renderCompleteList(list);
var rootNode = createElement(tree);
document.body.appendChild(rootNode);
```
A different way of calling the functions to make a list. Does not help that much here but may make things easier in certain scenarios.

### Memoization
I won't put up an example but you can see an example using this [here](https://github.com/Raynos/mercury/tree/master/docs/modules)

### Summary

I am not qualified to argue if templates, pure html or virtual-dom's are better for rendering html. I just find it fun how functional techniques could be applied. Hopefully the examples spark some interesting ideas.
